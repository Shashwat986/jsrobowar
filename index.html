<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>JSRoboWar</title>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="raphael.js"></script>
<script type="text/javascript" src="jsrobowar.js"></script>
<style type="text/css">
  body {
    padding: 1em;
    font-family: sans-serif;
    background: #ddd;
  }
  textarea {
    width: 45%;
    height: 20em;
    font-family: 'Menlo', 'Monaco', 'Bitstream Vera Sans Mono', 'Lucida Sans Console', monospace;
    font-size: 11px;
  }
  .errors {
    color: #c00;
  }
  #game div {
    float: left;
    padding-right: 1em;
  }
  #controls {
    clear: both;
  }
</style>
</head>
<body>

<div id="game">
  <div id="arena"></div>
  <div id="scoreboard"></div>
</div>

<div id="controls">
  <button id="play">Play</button>
  <button id="stop">Stop</button>
</div>

<section>
<h1>Robot 1</h1>
<textarea id="code1">
</textarea>
<textarea id="errors1" class="errors" readonly></textarea>
<br/>
<label for="color1">Color: </label><input type="text" id="color1" value="yellow"/>
</section>

<section>
<h1>Robot 2</h1>
<textarea id="code2">
</textarea>
<textarea id="errors2" class="errors" readonly></textarea>
<br/>
<label for="color2">Color: </label><input type="text" id="color2" value="cyan"/>
</section>

<script type="text/javascript">
  var game = undefined; // Really? I have to set this as undefined? C'mon...
  var bot1 = 'arachnee';
  var bot2 = 'zim';

  $(document).ready(function() {

    $('#play').click(function() {
      $(this).text('Restart');

      if (game) {
        game.stop();
        $('#arena').add('#scoreboard').children().remove();
      }
      game = new Game($('#arena')[0], $('#scoreboard')[0]);

      var program1 = new Program();
      program1.parse($('#code1').val());

      var program2 = new Program();
      program2.parse($('#code2').val());

      if (program1.errors || program2.errors) {
        $('#errors1').val(program1.errors);
        $('#errors2').val(program2.errors);
        return;
      }

      var r1 = new Robot(bot1, $('#color1').val(), program1);
      r1.max_energy = 60;
      r1.starting_damage = 150;
      r1.max_shield = 0;
      r1.speed = 30;
      r1.bullet_type = 'EXPLOSIVE';
      //r1.set_trace(true);
      game.add_robot(r1);

      var r2 = new Robot(bot2, $('#color2').val(), program2);
      r2.max_energy = 100;
      r2.starting_damage = 150;
      r2.max_shield = 25;
      r2.speed = 15;
      r2.bullet_type = 'RUBBER';
      //r2.set_trace(true);
      game.add_robot(r2);

      game.start();
    });

    $('#stop').click(function() {
      if (game) game.stop();
    });

    $('#code1').load('robots/' + bot1 + '.txt', function() {
    $('#code2').load('robots/' + bot2 + '.txt', function() {
    $('#play').click(); //XXX
    });
    });

  });
</script>

</body>
</html>
