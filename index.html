<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>JSRoboWar</title>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="raphael.js"></script>
<script type="text/javascript" src="jsrobowar.js"></script>
<style type="text/css">
  body {
    padding: 1em;
    font-family: sans-serif;
    background: #ddd;
  }
  textarea {
    width: 45%;
    height: 20em;
    font-family: 'Menlo', 'Monaco', 'Bitstream Vera Sans Mono', 'Lucida Sans Console', monospace;
    font-size: 11px;
  }
  .errors {
    color: #c00;
  }
  #game div {
    float: left;
    padding-right: 1em;
  }
  #controls {
    clear: both;
  }
</style>
</head>
<body>

<div id="game">
  <div id="arena"></div>
  <div id="scoreboard"></div>
</div>

<div id="controls">
  <button id="play">Play</button>
  <button id="stop">Stop</button>
</div>

<section>
<h1>Robot 1</h1>
<textarea id="code1">
# Bozo
# Written 8/22/93 by David Harris
# This robot uses interrupts.

    killem RANGE' SETINT
    INTON

main:
    AIM 5 + AIM' STORE
    main JUMP

killem:
    50 FIRE' STORE
    RTI
</textarea>
<textarea id="errors1" class="errors" readonly></textarea>
<br/>
<label for="color1">Color: </label><input type="text" id="color1" value="yellow"/>
</section>

<section>
<h1>Robot 2</h1>
<textarea id="code2">
#   Wall Seeker
#   by [your name]

Start:
    -5 speedx' store
Loop:
    x 30 &lt; AtWall ifg
    Loop jump

AtWall:
    0 speedx' store
SetAim:
    0 aim' store
WallLoop:
    aim 5 + aim' store
    range 0 &gt; Shoot if
    aim 180 &gt; SetAim WallLoop ifeg

Shoot:
    energy fire' store
    return
</textarea>
<textarea id="errors2" class="errors" readonly></textarea>
<br/>
<label for="color2">Color: </label><input type="text" id="color2" value="cyan"/>
</section>

<script type="text/javascript">
  var game = undefined; // Really? I have to set this as undefined? C'mon...

  $(document).ready(function() {

    $('#play').click(function() {
      $(this).text('Restart');

      if (game) {
        game.stop();
        $('#arena').add('#scoreboard').children().remove();
      }
      game = new Game($('#arena')[0], $('#scoreboard')[0]);

      var program1 = new Program();
      program1.parse($('#code1').val());

      var program2 = new Program();
      program2.parse($('#code2').val());

      if (program1.errors || program2.errors) {
        $('#errors1').val(program1.errors);
        $('#errors2').val(program2.errors);
        return;
      }

      game.add_robot(new Robot('Player 1', $('#color1').val(), program1));
      game.add_robot(new Robot('Player 2', $('#color2').val(), program2));
      //game.robots[1].set_trace(true); //XXX

      game.start();
    });

    $('#stop').click(function() {
      if (game) game.stop();
    });

    $('#play').click(); //XXX

  });
</script>

</body>
</html>
