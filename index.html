<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>JSRoboWar</title>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="raphael.js"></script>
<script type="text/javascript" src="jsrobowar.js"></script>
<style type="text/css">
  body {
    padding: 1em;
    font-family: sans-serif;
    background: #ddd;
  }
  textarea {
    width: 45%;
    height: 20em;
    font-family: 'Menlo', 'Monaco', 'Bitstream Vera Sans Mono', 'Lucida Sans Console', monospace;
    font-size: 11px;
  }
  .errors {
    color: #c00;
  }
  #game div {
    float: left;
    padding-right: 1em;
  }
  #controls {
    clear: both;
  }
</style>
</head>
<body>

<div id="game">
  <div id="arena"></div>
  <div id="scoreboard"></div>
</div>

<div id="controls">
  <button id="play">Play</button>
  <button id="stop">Stop</button>
</div>

<section>
<h1>Robot 1</h1>
<textarea id="code1">

#Energy 60
#Damage 150
#Shields 0
#Processor 30
#Explosive bullets
Start:
    x 150 &lt; StartLeft ifg
StartRight:
    x 280 &gt; StartAtRight ifg
    #The right parameter is at the default 280

    AtRight right' setint
    5 speedx' store
    Shoot range' setint
    inton
    FirstLoop jump

StartLeft:
    x 20 &lt; StartAtLeft ifg
    #The left parameter is at the default 20

    AtLeft left' setint
    -5 speedx' store
    Shoot range' setint
    inton
    FirstLoop jump



AtRight:
    0 speedx' store

StartAtRight:
    y 150 &gt; RightDown RightUp ifeg

RightDown:
    y 280 &gt; AtBottomRight ifg
    AtBottomRight bot' setint
    5 speedy' store
    inton
    FirstLoop jump


RightUp:
    y 20 &lt; AtTopRight ifg
    AtTopRight top' setint
    -5 speedy' store
    inton
    FirstLoop jump




AtLeft:
    0 speedx' store

StartAtLeft:
    y 150 &gt; LeftDown LeftUp ifeg

LeftDown:
    y 280 &gt; AtBottomLeft ifg
    AtBottomLeft bot' setint
    5 speedy' store
    inton
    FirstLoop jump

LeftUp:
    y 20 &lt; AtTopLeft ifg
    AtTopLeft top' setint
    -5 speedy' store
    inton
    FirstLoop jump


##############################################
#   Top left corner routines
##############################################


AtTopLeft:
    0 speedx' store
    0 speedy' store
    10 x - movex' store
    10 y - movey' store
    dropall
    DodgeTopLeft radar' setint
    70 radar' setparam
    inton
TopLeftLoop:
    90 aim' store
    120 aim' store
    135 aim' store
    150 aim' store
    180 aim' store
    TopLeftLoop jump

DodgeTopLeft:
    radar sync radar &lt; back ifg
    aim 135 &gt; DodgeTLtoRight DodgeTLtoBot ifeg

DodgeTLtoRight:
    10 speedx' store
    AtTopRight right' setint
    -1 radar' setint
    inton
    FirstLoop jump
DodgeTLtoBot:
    10 speedy' store
    AtBottomLeft bot' setint
    -1 radar' setint
    inton
    FirstLoop jump

##############################################
#   Bottom left corner routines
##############################################


AtBottomLeft:
    0 speedx' store
    0 speedy' store
    290 y - movey' store
    10 x - movex' store
    dropall
    DodgeBottomLeft radar' setint
    70 radar' setparam
    inton
BottomLeftLoop:
    0 aim' store
    30 aim' store
    45 aim' store
    60 aim' store
    90 aim' store
    BottomLeftLoop jump
DodgeBottomLeft:
    radar sync radar &lt; back ifg
    aim 45 &lt; DodgeBLtoRight DodgeBLtoTop ifeg

DodgeBLtoRight:
    10 speedx' store
    AtBottomRight right' setint
    -1 radar' setint
    inton
    FirstLoop jump
DodgeBLtoTop:
    -10 speedy' sto
    AtTopLeft top' setint
    -1 radar' setint
    inton
    FirstLoop jump


##############################################
#   Top right corner routines
##############################################


AtTopRight:
    0 speedx' store
    0 speedy' store
    290 x - movex' store
    10 y - movey' store
    dropall
    DodgeTopRight radar' setint
    70 radar' setparam
    inton
TopRightLoop:
    270 aim' store
    240 aim' store
    225 aim' store
    210 aim' store
    180 aim' store
    TopRightLoop jump
DodgeTopRight:
    radar sync radar &lt; back ifg
    aim 225 &gt; DodgeTRtoBot DodgeTRtoLeft ifeg

DodgeTRtoBot:
    10 speedy' store
    AtBottomRight bot' setint
    -1 radar' setint
    inton
    FirstLoop jump

DodgeTRtoLeft:
    -10 speedx' store
    AtTopLeft left' setint
    -1 radar' setint
    inton
    FirstLoop jump


##############################################
#   Bottom right corner routines
##############################################


AtBottomRight:
    0 speedx' store
    0 speedy' store
    290 y - movey' store
    290 x - movex' store
    dropall
    DodgeBottomRight radar' setint
    70 radar' setparam
    inton
BottomRightLoop:
    270 aim' store
    300 aim' store
    315 aim' store
    330 aim' store
    0 aim' store
    BottomRightLoop jump
DodgeBottomRight:
    radar sync radar &lt; back ifg
    aim 0 = aim 315 &gt; or
    DodgeBRtoLeft DodgeBRtoTop ifeg

DodgeBRtoLeft:
    -10 speedx' store
    AtBottomLeft left' setint
    -1 radar' setint
    inton
    FirstLoop jump

DodgeBRtoTop:
    -10 speedy' store
    AtTopRight top' setint
    -1 radar' setint
    inton
    FirstLoop jump


FirstLoop:
    0 aim' store
    30 aim' store
    60 aim' store
    90 aim' store
    120 aim' store
    150 aim' store
    180 aim' store
    210 aim' store
    240 aim' store
    270 aim' store
    300 aim' store
    330 aim' store
    FirstLoop jump

Shoot:
    range dup 60 &lt; and normalbullet ifg
    energy 20 - fire' store
    RTI
normalbullet:
    60 bullet' store
    60 bullet' store
    30 bullet' store
    RTI
back:
    RTI

</textarea>
<textarea id="errors1" class="errors" readonly></textarea>
<br/>
<label for="color1">Color: </label><input type="text" id="color1" value="yellow"/>
</section>

<section>
<h1>Robot 2</h1>
<textarea id="code2">

#Energy 100
#Damage 150
#Shields 25
#Processor 15
#Rubber bullets
#Missiles
    BounceRight left' setint
    BounceLeft right' setint
    BounceDown top' setint
    BounceUp bot' setint
    50 top' setparam
    50 left' setparam
    250 right' setparam
    250 bot' setparam
    Shoot range' setint
    inton
    3 speedx' sto
    3 speedy' sto
Main:
    aim 7 + aim' store
    25 shield' store
    Main jump

BounceRight:
    3 speedx' store
    RTI
BounceLeft:
    -3 speedx' store
    RTI
BounceUp:
    -3 speedy' store
    RTI
BounceDown:
    3 speedy' store
    RTI

Shoot:
    energy 2 / missile' store
    RTI

</textarea>
<textarea id="errors2" class="errors" readonly></textarea>
<br/>
<label for="color2">Color: </label><input type="text" id="color2" value="cyan"/>
</section>

<script type="text/javascript">
  var game = undefined; // Really? I have to set this as undefined? C'mon...

  $(document).ready(function() {

    $('#play').click(function() {
      $(this).text('Restart');

      if (game) {
        game.stop();
        $('#arena').add('#scoreboard').children().remove();
      }
      game = new Game($('#arena')[0], $('#scoreboard')[0]);

      var program1 = new Program();
      program1.parse($('#code1').val());

      var program2 = new Program();
      program2.parse($('#code2').val());

      if (program1.errors || program2.errors) {
        $('#errors1').val(program1.errors);
        $('#errors2').val(program2.errors);
        return;
      }

      var r1 = new Robot('Player 1', $('#color1').val(), program1);
      r1.max_energy = 60;
      r1.starting_damage = 150;
      r1.max_shield = 0;
      r1.speed = 30;
      r1.bullet_type = 'EXPLOSIVE';
      game.add_robot(r1);

      var r2 = new Robot('Player 2', $('#color2').val(), program2);
      r2.max_energy = 100;
      r2.starting_damage = 150;
      r2.max_shield = 25;
      r2.speed = 15;
      r2.bullet_type = 'RUBBER';
      game.add_robot(r2);

      game.start();
    });

    $('#stop').click(function() {
      if (game) game.stop();
    });

    $('#play').click(); //XXX

  });
</script>

</body>
</html>
